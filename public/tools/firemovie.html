<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Video Player</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for a modern look -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
        }
        /* Simple fade-in animation */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-blue-100 text-gray-800 flex items-center justify-center min-h-screen">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl w-full">
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800">Firebase Video Player</h1>
            <p class="text-gray-500 mt-3 text-lg">Firebase Storageから動画をストリーミング再生</p>
        </header>

        <main>
            <!-- Loading State -->
            <div id="loading-state" class="text-center p-10 bg-white/70 backdrop-blur-sm rounded-2xl shadow-lg">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
                <p class="text-lg mt-5 text-gray-600">動画を読み込んでいます...</p>
            </div>

            <!-- Video Player Container -->
            <div id="video-container" class="hidden bg-white rounded-2xl shadow-2xl overflow-hidden ring-1 ring-black ring-opacity-5">
                 <!-- Video Header -->
                <div class="bg-gray-800 text-white px-5 py-3 flex items-center justify-between">
                    <h2 class="font-semibold text-lg">Now Playing</h2>
                    <p id="video-filename" class="text-sm font-mono bg-gray-700 px-2 py-1 rounded-md"></p>
                </div>
                <!-- Video Element -->
                <div class="bg-black">
                    <video id="video-player" class="w-full h-full" controls controlsList="nodownload">
                        お使いのブラウザはビデオタグをサポートしていません。
                    </video>
                </div>
            </div>

            <!-- Error State -->
            <div id="error-state" class="hidden text-left p-6 bg-red-50 border border-red-400 text-red-800 rounded-2xl shadow-lg fade-in">
                <h2 class="font-bold text-xl mb-3 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    エラーが発生しました
                </h2>
                <p id="error-message" class="font-mono bg-red-100 p-3 rounded-lg mt-2"></p>
                <p class="mt-4 text-sm">Firebaseの設定、動画のパス、Storageのセキュリティルールが正しいか確認してください。</p>
            </div>
        </main>

        <footer class="text-center mt-10 text-sm text-gray-500">
            <p>このアプリを動作させるには、Firebaseプロジェクトの設定が必要です。</p>
        </footer>
    </div>

    <!-- Firebase SDK Scripts -->
    <script type="module">
        // Import the functions you need from the SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getStorage, ref, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        // --- ▼▼▼ 1. YOUR FIREBASE CONFIGURATION ▼▼▼ ---
        // Replace with your Firebase project's configuration object.
        const firebaseConfig = {
            apiKey: "AIzaSyAQuBnDhParCTXZXlBbMJ4KejMl0qB0l_o",
            authDomain: "imc-xp.firebaseapp.com",
            databaseURL: "https://imc-xp-default-rtdb.firebaseio.com",
            projectId: "imc-xp",
            storageBucket: "imc-xp.appspot.com",
            messagingSenderId: "605014806418",
            appId: "1:605014806418:web:1b27ee370b14caf036fb4b"
        };
        // --- ▲▲▲ 1. YOUR FIREBASE CONFIGURATION ▲▲▲ ---

        // --- ▼▼▼ 2. VIDEO FILE PATH IN FIREBASE STORAGE ▼▼▼ ---
        // Specify the path to your video file in Firebase Storage.
        const videoPath = "videos/sample.mp4";
        // --- ▲▲▲ 2. VIDEO FILE PATH IN FIREBASE STORAGE ▲▲▲ ---


        // --- Application Logic ---
        const loadingState = document.getElementById('loading-state');
        const videoContainer = document.getElementById('video-container');
        const videoPlayer = document.getElementById('video-player');
        const videoFilename = document.getElementById('video-filename');
        const errorState = document.getElementById('error-state');
        const errorMessage = document.getElementById('error-message');

        function showError(message, errorCode = '') {
            errorMessage.textContent = `${message} (Code: ${errorCode || 'N/A'})`;
            loadingState.classList.add('hidden');
            videoContainer.classList.add('hidden');
            errorState.classList.remove('hidden');
        }

        try {
            // Check if Firebase config is still the default placeholder
            if (firebaseConfig.apiKey === "YOUR_API_KEY") {
                throw new Error("Firebase設定がデフォルトのままです。`firebaseConfig`オブジェクトをあなたのプロジェクトの値に書き換えてください。");
            }

            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const storage = getStorage(app);
            const videoRef = ref(storage, videoPath);

            // Get the download URL for the video
            getDownloadURL(videoRef)
                .then((url) => {
                    // Set the video source and display the player
                    videoPlayer.setAttribute('src', url);
                    // Display the filename from the path
                    videoFilename.textContent = videoPath.split('/').pop();
                    
                    loadingState.classList.add('hidden');
                    videoContainer.classList.remove('hidden');
                    videoContainer.classList.add('fade-in');
                })
                .catch((error) => {
                    // Handle specific storage errors
                    console.error("Error getting download URL: ", error);
                    let userFriendlyError;
                    switch (error.code) {
                        case 'storage/object-not-found':
                            userFriendlyError = `動画が見つかりません。パスが正しいか確認してください: "${videoPath}"`;
                            break;
                        case 'storage/unauthorized':
                            userFriendlyError = "動画へのアクセス権限がありません。Firebase Storageのセキュリティルールを確認してください。";
                            break;
                        case 'storage/project-not-found':
                             userFriendlyError = "Firebaseプロジェクトが見つかりません。設定情報を確認してください。";
                             break;
                        default:
                            userFriendlyError = "動画の読み込みに失敗しました。設定またはネットワーク接続を確認してください。";
                    }
                    showError(userFriendlyError, error.code);
                });
        } catch (e) {
            console.error("Initialization Error: ", e);
            showError(e.message, 'initialization-error');
        }
    </script>
</body>
</html>
